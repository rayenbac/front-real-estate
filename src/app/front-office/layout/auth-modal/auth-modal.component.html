<div class="modal fade" id="authModal" tabindex="-1" role="dialog" aria-labelledby="authModalLabel" 
     [ngClass]="{'show': isVisible}" [style.display]="isVisible ? 'block' : 'none'" #modal>
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="authModalLabel">
          <ng-container *ngIf="isLoginMode">Login</ng-container>
          <ng-container *ngIf="!isLoginMode && !isForgotPasswordMode">Register</ng-container>
          <ng-container *ngIf="isForgotPasswordMode">Forgot Password</ng-container>
        </h5>
        <button type="button" class="close" (click)="closeModal()" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <!-- Tab Navigation (only show when not in forgot password mode) -->
        <ul *ngIf="!isForgotPasswordMode" class="nav nav-tabs mb-4" id="authTabs" role="tablist">
          <li class="nav-item">
            <a class="nav-link" [class.active]="isLoginMode" (click)="isLoginMode = true">Login</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" [class.active]="!isLoginMode" (click)="isLoginMode = false">Register</a>
          </li>
        </ul>

        <!-- Login Form -->
        <div *ngIf="isLoginMode && !isForgotPasswordMode">
          <form [formGroup]="loginForm" (ngSubmit)="onLogin()">
            <div class="form-group">
              <label for="loginEmail">Email</label>
              <input type="email" class="form-control" id="loginEmail" formControlName="email">
              <div class="text-danger" *ngIf="loginForm.get('email')?.invalid && loginForm.get('email')?.touched">
                Please enter a valid email
              </div>
            </div>
            <div class="form-group">
              <label for="loginPassword">Password</label>
              <input type="password" class="form-control" id="loginPassword" formControlName="password">
              <div class="text-danger" *ngIf="loginForm.get('password')?.invalid && loginForm.get('password')?.touched">
                Password is required and must be at least 6 characters
              </div>
            </div>
            <div class="form-group text-right">
              <a href="javascript:void(0)" class="forgot-password" (click)="showForgotPasswordForm()">Forgot Password?</a>
            </div>
            <button type="submit" class="btn btn-primary btn-block" [disabled]="loginForm.invalid || loading">
              {{ loading ? 'Logging in...' : 'Login' }}
            </button>
          </form>
        </div>

        <!-- Register Form -->
        <div *ngIf="!isLoginMode && !isForgotPasswordMode">
          <form [formGroup]="registerForm" (ngSubmit)="onRegister()">
            <div class="form-group">
              <label for="registerFirstName">First Name</label>
              <input type="text" class="form-control" id="registerFirstName" formControlName="firstName">
              <div class="text-danger" *ngIf="registerForm.get('firstName')?.invalid && registerForm.get('firstName')?.touched">
                First name is required
              </div>
            </div>
            <div class="form-group">
              <label for="registerLastName">Last Name</label>
              <input type="text" class="form-control" id="registerLastName" formControlName="lastName">
              <div class="text-danger" *ngIf="registerForm.get('lastName')?.invalid && registerForm.get('lastName')?.touched">
                Last name is required
              </div>
            </div>
            <div class="form-group">
              <label for="registerEmail">Email</label>
              <input type="email" class="form-control" id="registerEmail" formControlName="email">
              <div class="text-danger" *ngIf="registerForm.get('email')?.invalid && registerForm.get('email')?.touched">
                Please enter a valid email
              </div>
            </div>
            <div class="form-group">
              <label for="registerPassword">Password</label>
              <input type="password" class="form-control" id="registerPassword" formControlName="password">
              <div class="text-danger" *ngIf="registerForm.get('password')?.invalid && registerForm.get('password')?.touched">
                Password is required and must be at least 6 characters
              </div>
            </div>
            <div class="form-group">
              <label for="registerConfirmPassword">Confirm Password</label>
              <input type="password" class="form-control" id="registerConfirmPassword" formControlName="confirmPassword">
              <div class="text-danger" *ngIf="registerForm.get('confirmPassword')?.errors?.['passwordMismatch'] && registerForm.get('confirmPassword')?.touched">
                Passwords must match
              </div>
            </div>
            <div class="form-group">
              <label for="registerPhone">Phone (Optional)</label>
              <input type="tel" class="form-control" id="registerPhone" formControlName="phone">
            </div>
            <button type="submit" class="btn btn-primary btn-block" [disabled]="registerForm.invalid || loading">
              {{ loading ? 'Registering...' : 'Register' }}
            </button>
          </form>
        </div>

        <!-- Forgot Password Form -->
        <div *ngIf="isForgotPasswordMode">
          <p class="mb-4">Enter your email address and we'll send you a link to reset your password.</p>
          <form [formGroup]="forgotPasswordForm" (ngSubmit)="onForgotPassword()">
            <div class="form-group">
              <label for="forgotEmail">Email</label>
              <input type="email" class="form-control" id="forgotEmail" formControlName="email">
              <div class="text-danger" *ngIf="forgotPasswordForm.get('email')?.invalid && forgotPasswordForm.get('email')?.touched">
                Please enter a valid email
              </div>
            </div>
            <button type="submit" class="btn btn-primary btn-block" [disabled]="forgotPasswordForm.invalid || loading">
              {{ loading ? 'Sending...' : 'Send Reset Link' }}
            </button>
            <button type="button" class="btn btn-outline-secondary btn-block mt-2" (click)="backToLogin()">
              Back to Login
            </button>
          </form>
        </div>
      </div>
      <div class="modal-footer">
        <button *ngIf="!isForgotPasswordMode" type="button" class="btn btn-link" (click)="isLoginMode = !isLoginMode">
          {{ isLoginMode ? 'Need an account? Register' : 'Already have an account? Login' }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal backdrop -->
<div class="modal-backdrop fade show" *ngIf="isVisible" (click)="closeModal()"></div>